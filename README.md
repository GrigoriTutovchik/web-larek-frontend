# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

Продукт

```
export interface IProduct {
  id: string,
  title: string,
  description: string,
  image: string,
  category: ProductCategory,
  price: number | null
} 
```

Категория продукта

```
export type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Заказ

```
export interface IOrder {
  payment: PaymentMethod,
  email: string,
  phone: string,
  address: string,
  total: number | null,
  items: string[]
}
```

Тип оплаты

```
export type PaymentMethod = 'cash' | 'card';
```

Результат заказа

```
export interface IOrderResult {
  id: string;
  total: number;
}
```

Корзина

```
export interface IBascket {
  items:string[];
  total:number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component
 Базовый класс, конструктор которого принимает элемент разметки.

 Основные методы класса: 
  - toggleClass
  - setText
  - setDisabled
  - setHidden
  - setVisible
  - setImage
  - render

#### Класс Model

Базовая модель класса

Основные методы:

-emitChanges - позволяет отправлять уведомления о том, что произошли определённые изменения, которые могут быть "пойманы" или обработаны другими частями приложения.

### Слой данных

#### Класс AppData
Этот класс отвечает за хранение и логику работы с данными карточек товара, полученных с сервера. Он наследуется от базового класса модели данных и взаимодействует с брокером событий.

#### Конструктор
- EventBroker Instance**: Конструктор принимает экземпляр брокера событий, который используется для инициализации событий внутри класса.

#### Поля класса
- productCards (IProduct[] | null)**: Массив объектов карточек товара.
- preview (string | null)**: ID карточки, выбранной для просмотра в модальном окне или добавленной в корзину.

#### Методы класса
- productList Setter (info: IProduct[]): Сохраняет информацию о всех карточках товара в поле класса. Инициализирует событие изменения списка элементов.
- productList Getter: Возвращает данные из поля класса с сохраненными карточками товаров.
- productId Setter (id: string): Сохраняет ID одной карточки в поле класса preview. Инициализирует событие изменения предварительного просмотра.
- productId Getter: Возвращает значение из поля класса preview.
- getSelectedCard(): Возвращает данные выбранной карточки из массива всех карточек товара. Выполняет сравнение ID карточек в массиве с ID, хранящимся в поле класса preview.

### Классы представлений

#### Интерфейс IModal

Представляет содержимое модального окна

```
export interface IModal {
  content: HTMLElement;
}

```

#### Класс Modal

Общий класс для модальных окон

```
class Modal extends Component<IModal>  {
  closeButton: HTMLButtonElement - кнопка закрытия
  content: HTMLElement - содержимое модального окна
}
```

Конструктор constructor(container: HTMLElement, protected events: IEvents)

Основные методы:

- `set content` - установить содержимое модального окна
- `open` - открыть модальное окно, добавляя класс видимости к container и эмитируя событие modal:open.
- `close` - закрыть модальное окно, удаляя класс видимости из container, очищает содержимое и эмитирует событие modal:
  close.

#### Класс Form

Общий класс для работы с формами, наследуется от базового класса Сomponent

Поля класса:

-`_submit: HTMLButtonElement` - Кнопка подтверждения
-`errors: HTMLElement` - элемент для вывода ошибок валидации

Основные методы:

- `onInputChange` - изменение значений полей ввода
- `set valid` - активна ли кнопка отправки
- `set errors` - установка текстов ошибок


#### Класс Basket

Отображения корзины товаров в модальном окне, расширяет Modal

Поля класса:

-`_list: HTMLElement` - элемент разметки со списком
-`_total: HTMLElement` - элемент разметки для вывода общей суммы заказа
-`_button: HTMLButtonElement` - элемент разметки кнопки оформления заказа


Основные методы

- `set items` - установить список продуктов в корзине
- `set total` - установить общую сумму продуктов в корзине

#### Класс Page
Реализует отображение на странице продукта. Наследуется от базового класса Component.

Поля класса:
- `basketCount: HTMLElement` - элемент страницы для отображения количества товаров в корзине
- `galeryItems: HTMLElement[]`- массив элементов страницы для отображения карточек товара
- `locked: boolean`- значение, отвечающее за блокрировку прокрутки страницы

Методы:
- сеттер counter - пристваивает значение для отображения количества товаров в корзине
- сеттер galeryItems - выводит элементы карточек на страницу
- set locked - блокирует прокрутку страницы


#### Класс Card
Отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, категории, цены, а также возможность реагировать на действия пользователя добавить и удалить товар. Класс наследуется от базового Component и используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает интерфейс ICardActions для инициации событий.\

## Слой коммуникации

#### Класс LarekAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Основные события
- `basket:open` - открытие модального окна с корзиной
- `order:open` - открытие модального окна с формой сбора информации о способе оплаты, адресе доставки
- `order:submit` - открытие модального окна с формой сбора данных номер телефона, электронная почта
- `card:select` - выбор карточки
- `card:add` - добавление карточки в корзину
- `card:delete` - удаление карточки из корзины
- `order:submit` - сохранение данных о способе оплаты и адресе доставки
- `contacts:submit` - событие отправка товара на оплату
- `modal:close` - событие, сообщающее о закрытии любого модального окна
- `modal:open` - событие, сообщающее об открытии любого модального окна