# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

Продукт

```
export interface IProduct {
  id: string,
  title: string,
  description: string,
  image: string,
  category: ProductCategory,
  price: number | null
} 
```

Категория продукта

```
export type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Заказ

```
export interface IOrder {
  payment: PaymentMethod,
  email: string,
  phone: string,
  address: string,
  total: number | null,
  items: string[]
}
```

Тип оплаты

```
export type PaymentMethod = 'cash' | 'card';
```

Результат заказа

```
export interface IOrderResult {
  id: string;
  total: number;
}
```

Корзина

```
export interface IBascket {
  items:string[];
  total:number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component
 Базовый класс, конструктор которого принимает элемент разметки.

 Основные методы класса: 
  - `toggleClass`
  - `setText`
  - `setDisabled`
  - `setImage`
  - `render`

#### Класс View 
Наследует класс Component<T> и представляет собой компонент пользовательского интерфейса (Basket, Page) с возможностью обработки событий. Он расширяет базовый функционал, предоставленный классом Component<T>, добавляя возможность работы с событиями через объект events типа EventEmitter

### Слой данных

#### Класс AppData
Этот класс отвечает за хранение и логику работы с данными карточек товара, полученных с сервера. Он наследуется от базового класса модели данных и взаимодействует с брокером событий.

Свойства класса:

- `items` - содержит в себе весь список продуктов
- `basket` - содержит корзину пользователя
- `order` - содержит в себе данные для заказа
- `formErrors` - для установки сообщений об ошибке в методах валидации
- `preview` - id карточки, выбранной для просмотра в модальной окне или добавленной в корзину.

Методы класса:

- `setItems` - метод для инициализации списка товаров, полученных с сервера
- `inBasket` - проверка наличия товара в корзине
- `addToBasket` - добавляет товар в корзину
- `removeFromBasket` - удаляет товар из корзины
- `setPreview` - установка контента для модального окна
- `clearBasket` - очищает корзину пользователя
- `setOrderField` - установка всех данных о заказе при успешной валидации
- `validationField` - валидация полей всех форм

### Классы представлений

#### Интерфейс IModal

Представляет содержимое модального окна

```
export interface IModal {
  content: HTMLElement;
}

```

#### Класс Modal

Общий класс для модальных окон

```
class Modal extends Component<IModal>  {
  closeButton: HTMLButtonElement - кнопка закрытия
  content: HTMLElement - содержимое модального окна
}
```

Конструктор constructor(container: HTMLElement, protected events: IEvents)

Основные методы:

- `set content` - установить содержимое модального окна
- `open` - открыть модальное окно, добавляя класс видимости к container и эмитируя событие modal:open.
- `close` - закрыть модальное окно, удаляя класс видимости из container, очищает содержимое и эмитирует событие modal:
  close.
- `render` - отрисовка содержимого модального окна в зависимости от контекста

#### Класс Form

Общий класс для работы с формами, наследуется от базового класса Сomponent

Поля класса:

-`_submit: HTMLButtonElement` - Кнопка подтверждения
-`errors: HTMLElement` - элемент для вывода ошибок валидации

Основные методы:

- `onInputChange` - изменение значений полей ввода
- `set valid` - активна ли кнопка отправки
- `set errors` - установка текстов ошибок
-  `render` - для отображения формы с учетом переданного состояния

#### Класс Basket

Отображения корзины товаров в модальном окне, расширяет Modal

Поля класса:

-`_list: HTMLElement` - элемент разметки со списком
-`_total: HTMLElement` - элемент разметки для вывода общей суммы заказа
-`_button: HTMLButtonElement` - элемент разметки кнопки оформления заказа


Основные методы

- `set items` - установить список продуктов в корзине
- `set total` - установить общую сумму продуктов в корзине

#### Класс Success
Класс для отображения сообщения об успешном завершении операции или процесса, а так же отображения общей суммы операции, наследует класс Component и использует интерфейс ISuccess для определения структуры данных, ожидаемых в компоненте Success

Свойства класса:

- `totalPrice` - элемент для отображения общей суммы операции
- `close` - html элемент кнопки закрытия
- `events` - для события клика по кнопке после завершения заказа

Методы класса:

- **set total** - устанавливает текст, отображающий сумму операции

#### Класс Page
Реализует отображение на странице продукта. Наследуется от базового класса Component.

Поля класса:
- `basket` - кнопка, открывающая модальное окно корзины
- `catalog` - отображение каталога товаров
- `counter` - число товаров
- `wraper` - элемент обертки страницы

Методы:
- `set counter` - пристваивает значение для отображения количества товаров в корзине
- `set galeryItems` - выводит элементы карточек на страницу
- `set locked` - блокирует прокрутку страницы

#### Класс Order
Класс для реализации отображения и управления формой доставки, наследует класс Form и реализует интерфейс IOrderForm

Свойства класса:

- `paymentCard` = элемент кнопки оплаты онлайн
- `paymentCash` - элемент кнопки оплаты за наличные

Методы класса:

- `set payment` - переключает активность кнопок оплаты
- `set address` - устанавливает адрес доставки

#### Класс ContactForm
Класс для реализации работы с формой контактных данных, наследует класс Form и реализует интерфейс IContactsForm

Методы класса:

- `set phone` - устанавливает номер телефона
- `set email` - устанавливает адрес электронной почты

#### Класс Card
Отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, категории, цены, а также возможность реагировать на действия пользователя добавить и удалить товар. Класс наследуется от базового Component и используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.

Свойства класса:

- `title` - элемент для отображения названия товара
- `price` - элемент для отображения цены товара
- `image` - элемент для отображения изображения товара (необязательный)
- `description` - элемент для отображения описания товара (необязательный)
- `category` - элемент для отображения категории товара (необязательный)
- `button` - элемент для действия на карточке товара (необязательный)

Методы класса:

- `set/get title` - управляет названием товара
- `set/get price` - управляет ценой товара
- `set image` - устанавливает изображение товара
- `set description` - устанавливает описание товара
- `set/get category` -  управляет категорией товара
- `disablePriceButton` - управляет доступностью кнопки
- `set buttonTitle` - отображение текстового содержимым кнопки


## Слой коммуникации

#### Класс WebLarekAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Методы класса:

- `getProductList` - получает данные о каталоге товаров и возвращает массив объектов
- `getProductItem` - получает данные о конкретном товаре и возвращает объект с информацией о товаре
- `orderProducts` - отправляет заказ post запросом на сервер


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Основные события
- `basket:open` - открытие модального окна с корзинойv
- `order:open` - открытие модального окна с формой сбора информации о способе оплаты, адресе доставки
- `order:submit` - открытие модального окна с формой сбора данных номер телефона, электронная почта
- `card:select` - выбор карточки
- `contacts:submit` - событие отправка товара на оплату
- `modal:close` - событие, сообщающее о закрытии любого модального окна
- `modal:open` - событие, сообщающее об открытии любого модального окна
- `^contacts\..*:change` - изменение полей контактной информации, обновление данных о контактах в приложении
- `^order\..*:change` - изменение адреса заказа, обновление соответствующего поля в приложении
- `order:result` - очищает корзину и закрывает модальное окно
- `formErrors:change` - изменение ошибок в форме заказа, обновление статуса валидации и ошибок для формы оплаты и контактов
- `basket:change` - изменение списка товаров в корзине, обновление количества товаров на странице
- `preview:change` - отображает модальное окно с информацией о товаре
- `items:change` - изменение списка товаров, вызывает перерисовку каталога на странице